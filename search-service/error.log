{"level":"error","message":"failed to connect to server consumeEvent is not defined","service":"post-service","stack":"ReferenceError: consumeEvent is not defined\n    at startServer (file:///Users/ogoncharenko/Projects/social-media-microservices/search-service/src/server.js:47:5)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-03-21T01:06:31.797Z"}
{"level":"error","message":"Error handling creation event for posts Search is not defined","service":"post-service","stack":"ReferenceError: Search is not defined\n    at searchEventHandler (file:///Users/ogoncharenko/Projects/social-media-microservices/search-service/src/eventHandlers/searchEventHandler.js:5:27)\n    at file:///Users/ogoncharenko/Projects/social-media-microservices/search-service/src/utils/rabbitmq.js:35:7\n    at Channel.dispatchMessage (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/amqplib/lib/channel.js:485:14)\n    at Channel.handleDelivery (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/amqplib/lib/channel.js:494:17)\n    at Channel.emit (node:events:518:28)\n    at /Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/amqplib/lib/channel.js:391:10\n    at Channel.content [as handleMessage] (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/amqplib/lib/channel.js:444:9)\n    at Channel.acceptMessageFrame (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/amqplib/lib/channel.js:228:33)\n    at Channel.accept (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/amqplib/lib/channel.js:298:19)\n    at Connection.mainAccept [as accept] (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/amqplib/lib/connection.js:579:33)","timestamp":"2025-03-21T01:10:22.881Z"}
{"code":11000,"errorLabelSet":{},"errorResponse":{"code":11000,"errmsg":"E11000 duplicate key error collection: social-media-microservices.searches index: userId_1 dup key: { userId: \"67d9bef46c9708f48dc1341f\" }","index":0,"keyPattern":{"userId":1},"keyValue":{"userId":"67d9bef46c9708f48dc1341f"}},"index":0,"keyPattern":{"userId":1},"keyValue":{"userId":"67d9bef46c9708f48dc1341f"},"level":"error","message":"Error handling creation event for posts E11000 duplicate key error collection: social-media-microservices.searches index: userId_1 dup key: { userId: \"67d9bef46c9708f48dc1341f\" }","service":"post-service","stack":"MongoServerError: E11000 duplicate key error collection: social-media-microservices.searches index: userId_1 dup key: { userId: \"67d9bef46c9708f48dc1341f\" }\n    at InsertOneOperation.execute (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/operations/insert.js:51:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async tryOperation (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/operations/execute_operation.js:207:20)\n    at async executeOperation (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/operations/execute_operation.js:75:16)\n    at async Collection.insertOne (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/collection.js:157:16)","timestamp":"2025-03-21T01:13:38.959Z"}
{"code":11000,"errorLabelSet":{},"errorResponse":{"code":11000,"errmsg":"E11000 duplicate key error collection: social-media-microservices.searches index: userId_1 dup key: { userId: \"67d9bef46c9708f48dc1341f\" }","index":0,"keyPattern":{"userId":1},"keyValue":{"userId":"67d9bef46c9708f48dc1341f"}},"index":0,"keyPattern":{"userId":1},"keyValue":{"userId":"67d9bef46c9708f48dc1341f"},"level":"error","message":"Error handling creation event for posts E11000 duplicate key error collection: social-media-microservices.searches index: userId_1 dup key: { userId: \"67d9bef46c9708f48dc1341f\" }","service":"post-service","stack":"MongoServerError: E11000 duplicate key error collection: social-media-microservices.searches index: userId_1 dup key: { userId: \"67d9bef46c9708f48dc1341f\" }\n    at InsertOneOperation.execute (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/operations/insert.js:51:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async tryOperation (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/operations/execute_operation.js:207:20)\n    at async executeOperation (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/operations/execute_operation.js:75:16)\n    at async Collection.insertOne (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/collection.js:157:16)","timestamp":"2025-03-21T01:15:11.304Z"}
{"code":11000,"errorLabelSet":{},"errorResponse":{"code":11000,"errmsg":"E11000 duplicate key error collection: social-media-microservices.searches index: userId_1 dup key: { userId: \"67d9bef46c9708f48dc1341f\" }","index":0,"keyPattern":{"userId":1},"keyValue":{"userId":"67d9bef46c9708f48dc1341f"}},"index":0,"keyPattern":{"userId":1},"keyValue":{"userId":"67d9bef46c9708f48dc1341f"},"level":"error","message":"Error handling creation event for posts E11000 duplicate key error collection: social-media-microservices.searches index: userId_1 dup key: { userId: \"67d9bef46c9708f48dc1341f\" }","service":"post-service","stack":"MongoServerError: E11000 duplicate key error collection: social-media-microservices.searches index: userId_1 dup key: { userId: \"67d9bef46c9708f48dc1341f\" }\n    at InsertOneOperation.execute (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/operations/insert.js:51:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async tryOperation (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/operations/execute_operation.js:207:20)\n    at async executeOperation (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/operations/execute_operation.js:75:16)\n    at async Collection.insertOne (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/collection.js:157:16)","timestamp":"2025-03-21T01:15:46.639Z"}
{"level":"error","message":"Error searching for posts {(intermediate value)}.sort is not a function","service":"search-service","stack":"TypeError: {(intermediate value)}.sort is not a function\n    at searchPostController (file:///Users/ogoncharenko/Projects/social-media-microservices/search-service/src/controllers/searchController.js:14:10)\n    at Layer.handle [as handle_request] (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/express/lib/router/layer.js:95:5)\n    at next (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/express/lib/router/route.js:149:13)\n    at Route.dispatch (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/express/lib/router/route.js:119:3)\n    at Layer.handle [as handle_request] (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/express/lib/router/layer.js:95:5)\n    at /Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/express/lib/router/index.js:284:15\n    at Function.process_params (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/express/lib/router/index.js:346:12)\n    at next (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/express/lib/router/index.js:280:10)\n    at authenticateRequest (file:///Users/ogoncharenko/Projects/social-media-microservices/search-service/src/middlewares/authMeddleware.js:12:3)\n    at Layer.handle [as handle_request] (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/express/lib/router/layer.js:95:5)","timestamp":"2025-03-21T02:14:27.039Z"}
{"$clusterTime":{"clusterTime":{"$timestamp":"7484085864532803587"},"signature":{"hash":"AfOrgiXcrW7kIgOXzHdHWS/VgWw=","keyId":{"high":1734019773,"low":15,"unsigned":false}}},"code":2,"codeName":"BadValue","errorLabelSet":{},"errorResponse":{"$clusterTime":{"clusterTime":{"$timestamp":"7484085864532803587"},"signature":{"hash":"AfOrgiXcrW7kIgOXzHdHWS/VgWw=","keyId":{"high":1734019773,"low":15,"unsigned":false}}},"code":2,"codeName":"BadValue","errmsg":"unknown top level operator: $content. If you have a field name that starts with a '$' symbol, consider using $getField or $setField.","ok":0,"operationTime":{"$timestamp":"7484085864532803586"}},"level":"error","message":"Error searching for posts unknown top level operator: $content. If you have a field name that starts with a '$' symbol, consider using $getField or $setField.","ok":0,"operationTime":{"$timestamp":"7484085864532803586"},"service":"search-service","stack":"MongoServerError: unknown top level operator: $content. If you have a field name that starts with a '$' symbol, consider using $getField or $setField.\n    at Connection.sendCommand (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/cmap/connection.js:299:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async Connection.command (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/cmap/connection.js:327:26)\n    at async Server.command (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/sdam/server.js:168:29)\n    at async FindOperation.execute (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/operations/find.js:36:16)\n    at async tryOperation (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/operations/execute_operation.js:207:20)\n    at async executeOperation (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/operations/execute_operation.js:75:16)\n    at async FindCursor._initialize (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/cursor/find_cursor.js:61:26)\n    at async FindCursor.cursorInit (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/cursor/abstract_cursor.js:633:27)\n    at async FindCursor.fetchBatch (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/cursor/abstract_cursor.js:667:13)","timestamp":"2025-03-21T02:35:29.109Z"}
{"$clusterTime":{"clusterTime":{"$timestamp":"7484093754387726338"},"signature":{"hash":"NrSeS90oEUMRHlZJ9OGRefHDRxs=","keyId":{"high":1734019773,"low":15,"unsigned":false}}},"code":2,"codeName":"BadValue","errorLabelSet":{},"errorResponse":{"$clusterTime":{"clusterTime":{"$timestamp":"7484093754387726338"},"signature":{"hash":"NrSeS90oEUMRHlZJ9OGRefHDRxs=","keyId":{"high":1734019773,"low":15,"unsigned":false}}},"code":2,"codeName":"BadValue","errmsg":"unknown operator: $meta","ok":0,"operationTime":{"$timestamp":"7484093754387726338"}},"level":"error","message":"Error searching for posts unknown operator: $meta","ok":0,"operationTime":{"$timestamp":"7484093754387726338"},"service":"search-service","stack":"MongoServerError: unknown operator: $meta\n    at Connection.sendCommand (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/cmap/connection.js:299:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async Connection.command (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/cmap/connection.js:327:26)\n    at async Server.command (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/sdam/server.js:168:29)\n    at async FindOperation.execute (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/operations/find.js:36:16)\n    at async tryOperation (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/operations/execute_operation.js:207:20)\n    at async executeOperation (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/operations/execute_operation.js:75:16)\n    at async FindCursor._initialize (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/cursor/find_cursor.js:61:26)\n    at async FindCursor.cursorInit (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/cursor/abstract_cursor.js:633:27)\n    at async FindCursor.fetchBatch (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/cursor/abstract_cursor.js:667:13)","timestamp":"2025-03-21T03:06:05.996Z"}
{"$clusterTime":{"clusterTime":{"$timestamp":"7484093990610927631"},"signature":{"hash":"/jux7tmLNWrLIExAqu9hs7GQ+Sc=","keyId":{"high":1734019773,"low":15,"unsigned":false}}},"code":2,"codeName":"BadValue","errorLabelSet":{},"errorResponse":{"$clusterTime":{"clusterTime":{"$timestamp":"7484093990610927631"},"signature":{"hash":"/jux7tmLNWrLIExAqu9hs7GQ+Sc=","keyId":{"high":1734019773,"low":15,"unsigned":false}}},"code":2,"codeName":"BadValue","errmsg":"unknown operator: $meta","ok":0,"operationTime":{"$timestamp":"7484093990610927631"}},"level":"error","message":"Error searching for posts unknown operator: $meta","ok":0,"operationTime":{"$timestamp":"7484093990610927631"},"service":"search-service","stack":"MongoServerError: unknown operator: $meta\n    at Connection.sendCommand (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/cmap/connection.js:299:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async Connection.command (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/cmap/connection.js:327:26)\n    at async Server.command (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/sdam/server.js:168:29)\n    at async FindOperation.execute (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/operations/find.js:36:16)\n    at async tryOperation (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/operations/execute_operation.js:207:20)\n    at async executeOperation (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/operations/execute_operation.js:75:16)\n    at async FindCursor._initialize (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/cursor/find_cursor.js:61:26)\n    at async FindCursor.cursorInit (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/cursor/abstract_cursor.js:633:27)\n    at async FindCursor.fetchBatch (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/cursor/abstract_cursor.js:667:13)","timestamp":"2025-03-21T03:07:02.061Z"}
{"$clusterTime":{"clusterTime":{"$timestamp":"7484094149524717583"},"signature":{"hash":"SOOPLGnGc/hU6XycDcFky1itZBc=","keyId":{"high":1734019773,"low":15,"unsigned":false}}},"code":2,"codeName":"BadValue","errorLabelSet":{},"errorResponse":{"$clusterTime":{"clusterTime":{"$timestamp":"7484094149524717583"},"signature":{"hash":"SOOPLGnGc/hU6XycDcFky1itZBc=","keyId":{"high":1734019773,"low":15,"unsigned":false}}},"code":2,"codeName":"BadValue","errmsg":"unknown operator: $meta","ok":0,"operationTime":{"$timestamp":"7484094149524717583"}},"level":"error","message":"Error searching for posts unknown operator: $meta","ok":0,"operationTime":{"$timestamp":"7484094149524717583"},"service":"search-service","stack":"MongoServerError: unknown operator: $meta\n    at Connection.sendCommand (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/cmap/connection.js:299:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async Connection.command (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/cmap/connection.js:327:26)\n    at async Server.command (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/sdam/server.js:168:29)\n    at async FindOperation.execute (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/operations/find.js:36:16)\n    at async tryOperation (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/operations/execute_operation.js:207:20)\n    at async executeOperation (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/operations/execute_operation.js:75:16)\n    at async FindCursor._initialize (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/cursor/find_cursor.js:61:26)\n    at async FindCursor.cursorInit (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/cursor/abstract_cursor.js:633:27)\n    at async FindCursor.fetchBatch (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/cursor/abstract_cursor.js:667:13)","timestamp":"2025-03-21T03:07:38.812Z"}
{"$clusterTime":{"clusterTime":{"$timestamp":"7484094355683147791"},"signature":{"hash":"lGefrrOQGyv22D2YJGHuJfHmHRE=","keyId":{"high":1734019773,"low":15,"unsigned":false}}},"code":40218,"codeName":"Location40218","errorLabelSet":{},"errorResponse":{"$clusterTime":{"clusterTime":{"$timestamp":"7484094355683147791"},"signature":{"hash":"lGefrrOQGyv22D2YJGHuJfHmHRE=","keyId":{"high":1734019773,"low":15,"unsigned":false}}},"code":40218,"codeName":"Location40218","errmsg":"query requires text score metadata, but it is not available","ok":0,"operationTime":{"$timestamp":"7484094355683147791"}},"level":"error","message":"Error searching for posts query requires text score metadata, but it is not available","ok":0,"operationTime":{"$timestamp":"7484094355683147791"},"service":"search-service","stack":"MongoServerError: query requires text score metadata, but it is not available\n    at Connection.sendCommand (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/cmap/connection.js:299:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async Connection.command (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/cmap/connection.js:327:26)\n    at async Server.command (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/sdam/server.js:168:29)\n    at async FindOperation.execute (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/operations/find.js:36:16)\n    at async tryOperation (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/operations/execute_operation.js:207:20)\n    at async executeOperation (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/operations/execute_operation.js:75:16)\n    at async FindCursor._initialize (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/cursor/find_cursor.js:61:26)\n    at async FindCursor.cursorInit (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/cursor/abstract_cursor.js:633:27)\n    at async FindCursor.fetchBatch (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/cursor/abstract_cursor.js:667:13)","timestamp":"2025-03-21T03:08:27.202Z"}
{"$clusterTime":{"clusterTime":{"$timestamp":"7484094914028896275"},"signature":{"hash":"HUkBqg/Xmd/90O/MhQ9aXLcAYGA=","keyId":{"high":1734019773,"low":15,"unsigned":false}}},"code":2,"codeName":"BadValue","errorLabelSet":{},"errorResponse":{"$clusterTime":{"clusterTime":{"$timestamp":"7484094914028896275"},"signature":{"hash":"HUkBqg/Xmd/90O/MhQ9aXLcAYGA=","keyId":{"high":1734019773,"low":15,"unsigned":false}}},"code":2,"codeName":"BadValue","errmsg":"unknown operator: $meta","ok":0,"operationTime":{"$timestamp":"7484094914028896275"}},"level":"error","message":"Error searching for posts unknown operator: $meta","ok":0,"operationTime":{"$timestamp":"7484094914028896275"},"service":"search-service","stack":"MongoServerError: unknown operator: $meta\n    at Connection.sendCommand (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/cmap/connection.js:299:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async Connection.command (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/cmap/connection.js:327:26)\n    at async Server.command (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/sdam/server.js:168:29)\n    at async FindOperation.execute (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/operations/find.js:36:16)\n    at async tryOperation (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/operations/execute_operation.js:207:20)\n    at async executeOperation (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/operations/execute_operation.js:75:16)\n    at async FindCursor._initialize (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/cursor/find_cursor.js:61:26)\n    at async FindCursor.cursorInit (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/cursor/abstract_cursor.js:633:27)\n    at async FindCursor.fetchBatch (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/cursor/abstract_cursor.js:667:13)","timestamp":"2025-03-21T03:10:36.689Z"}
{"$clusterTime":{"clusterTime":{"$timestamp":"7484095012813144075"},"signature":{"hash":"4LMwpzOWTo0h4k48gJKAnvJ4NnM=","keyId":{"high":1734019773,"low":15,"unsigned":false}}},"code":291,"codeName":"NoQueryExecutionPlans","errorLabelSet":{},"errorResponse":{"$clusterTime":{"clusterTime":{"$timestamp":"7484095012813144075"},"signature":{"hash":"4LMwpzOWTo0h4k48gJKAnvJ4NnM=","keyId":{"high":1734019773,"low":15,"unsigned":false}}},"code":291,"codeName":"NoQueryExecutionPlans","errmsg":"error processing query: ns=social-media-microservices.searches limit=10Tree: $or\n    content regex /some/i\n    TEXT : query=some, language=english, caseSensitive=0, diacriticSensitive=0\nSort: {}\nProj: {}\n planner returned error :: caused by :: Failed to produce a solution for TEXT under OR - other non-TEXT clauses under OR have to be indexed as well.","ok":0,"operationTime":{"$timestamp":"7484095012813144075"}},"level":"error","message":"Error searching for posts error processing query: ns=social-media-microservices.searches limit=10Tree: $or\n    content regex /some/i\n    TEXT : query=some, language=english, caseSensitive=0, diacriticSensitive=0\nSort: {}\nProj: {}\n planner returned error :: caused by :: Failed to produce a solution for TEXT under OR - other non-TEXT clauses under OR have to be indexed as well.","ok":0,"operationTime":{"$timestamp":"7484095012813144075"},"service":"search-service","stack":"MongoServerError: error processing query: ns=social-media-microservices.searches limit=10Tree: $or\n    content regex /some/i\n    TEXT : query=some, language=english, caseSensitive=0, diacriticSensitive=0\nSort: {}\nProj: {}\n planner returned error :: caused by :: Failed to produce a solution for TEXT under OR - other non-TEXT clauses under OR have to be indexed as well.\n    at Connection.sendCommand (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/cmap/connection.js:299:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async Connection.command (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/cmap/connection.js:327:26)\n    at async Server.command (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/sdam/server.js:168:29)\n    at async FindOperation.execute (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/operations/find.js:36:16)\n    at async tryOperation (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/operations/execute_operation.js:207:20)\n    at async executeOperation (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/operations/execute_operation.js:75:16)\n    at async FindCursor._initialize (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/cursor/find_cursor.js:61:26)\n    at async FindCursor.cursorInit (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/cursor/abstract_cursor.js:633:27)\n    at async FindCursor.fetchBatch (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/cursor/abstract_cursor.js:667:13)","timestamp":"2025-03-21T03:10:59.778Z"}
{"$clusterTime":{"clusterTime":{"$timestamp":"7484095085827588101"},"signature":{"hash":"BvP8Eiu+ZQvSM/facvUgFvMs8Nw=","keyId":{"high":1734019773,"low":15,"unsigned":false}}},"code":291,"codeName":"NoQueryExecutionPlans","errorLabelSet":{},"errorResponse":{"$clusterTime":{"clusterTime":{"$timestamp":"7484095085827588101"},"signature":{"hash":"BvP8Eiu+ZQvSM/facvUgFvMs8Nw=","keyId":{"high":1734019773,"low":15,"unsigned":false}}},"code":291,"codeName":"NoQueryExecutionPlans","errmsg":"error processing query: ns=social-media-microservices.searches limit=10Tree: $or\n    content regex /some/i\n    TEXT : query=some, language=english, caseSensitive=0, diacriticSensitive=0\nSort: {}\nProj: {}\n planner returned error :: caused by :: Failed to produce a solution for TEXT under OR - other non-TEXT clauses under OR have to be indexed as well.","ok":0,"operationTime":{"$timestamp":"7484095085827588101"}},"level":"error","message":"Error searching for posts error processing query: ns=social-media-microservices.searches limit=10Tree: $or\n    content regex /some/i\n    TEXT : query=some, language=english, caseSensitive=0, diacriticSensitive=0\nSort: {}\nProj: {}\n planner returned error :: caused by :: Failed to produce a solution for TEXT under OR - other non-TEXT clauses under OR have to be indexed as well.","ok":0,"operationTime":{"$timestamp":"7484095085827588101"},"service":"search-service","stack":"MongoServerError: error processing query: ns=social-media-microservices.searches limit=10Tree: $or\n    content regex /some/i\n    TEXT : query=some, language=english, caseSensitive=0, diacriticSensitive=0\nSort: {}\nProj: {}\n planner returned error :: caused by :: Failed to produce a solution for TEXT under OR - other non-TEXT clauses under OR have to be indexed as well.\n    at Connection.sendCommand (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/cmap/connection.js:299:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async Connection.command (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/cmap/connection.js:327:26)\n    at async Server.command (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/sdam/server.js:168:29)\n    at async FindOperation.execute (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/operations/find.js:36:16)\n    at async tryOperation (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/operations/execute_operation.js:207:20)\n    at async executeOperation (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/operations/execute_operation.js:75:16)\n    at async FindCursor._initialize (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/cursor/find_cursor.js:61:26)\n    at async FindCursor.cursorInit (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/cursor/abstract_cursor.js:633:27)\n    at async FindCursor.fetchBatch (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongodb/lib/cursor/abstract_cursor.js:667:13)","timestamp":"2025-03-21T03:11:16.344Z"}
{"level":"error","message":"Error handling creation event for posts req is not defined","service":"search-service","stack":"ReferenceError: req is not defined\n    at invalidatePostCache (file:///Users/ogoncharenko/Projects/social-media-microservices/search-service/src/eventHandlers/searchEventHandler.js:6:3)\n    at searchEventHandler (file:///Users/ogoncharenko/Projects/social-media-microservices/search-service/src/eventHandlers/searchEventHandler.js:23:11)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-03-21T16:34:20.281Z"}
{"level":"error","message":"failed to connect to server req is not defined","service":"search-service","stack":"ReferenceError: req is not defined\n    at startServer (file:///Users/ogoncharenko/Projects/social-media-microservices/search-service/src/server.js:57:64)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-03-21T16:37:36.370Z"}
{"level":"error","message":"failed to connect to server req is not defined","service":"search-service","stack":"ReferenceError: req is not defined\n    at startServer (file:///Users/ogoncharenko/Projects/social-media-microservices/search-service/src/server.js:57:64)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-03-21T16:37:43.707Z"}
{"_message":"Search validation failed","errors":{"content":{"kind":"required","message":"Path `content` is required.","name":"ValidatorError","path":"content","properties":{"message":"Path `content` is required.","path":"content","type":"required"}},"createdAt":{"kind":"required","message":"Path `createdAt` is required.","name":"ValidatorError","path":"createdAt","properties":{"message":"Path `createdAt` is required.","path":"createdAt","type":"required"}},"postId":{"kind":"required","message":"Path `postId` is required.","name":"ValidatorError","path":"postId","properties":{"message":"Path `postId` is required.","path":"postId","type":"required"}},"userId":{"kind":"required","message":"Path `userId` is required.","name":"ValidatorError","path":"userId","properties":{"message":"Path `userId` is required.","path":"userId","type":"required"}}},"level":"error","message":"Error handling creation event for posts Search validation failed: postId: Path `postId` is required., userId: Path `userId` is required., content: Path `content` is required., createdAt: Path `createdAt` is required.","service":"search-service","stack":"ValidationError: Search validation failed: postId: Path `postId` is required., userId: Path `userId` is required., content: Path `content` is required., createdAt: Path `createdAt` is required.\n    at Document.invalidate (/Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongoose/lib/document.js:3329:32)\n    at /Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongoose/lib/document.js:3090:17\n    at /Users/ogoncharenko/Projects/social-media-microservices/search-service/node_modules/mongoose/lib/schemaType.js:1407:9\n    at process.processTicksAndRejections (node:internal/process/task_queues:85:11)","timestamp":"2025-03-21T16:41:21.463Z"}
